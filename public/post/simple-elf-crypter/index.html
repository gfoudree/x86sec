<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=51372&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple ELF Crypter · x86sec</title>

  <meta name="description" content="Vulnerability research, kernel exploitation, and reverse engineering.">
  <meta name="author" content="Grant Foudree">

  
  <meta property="og:title" content="Simple ELF Crypter">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://localhost:51372/post/simple-elf-crypter/">

  
  <link rel="canonical" href="http://localhost:51372/post/simple-elf-crypter/">
  <link rel="alternate" type="application/rss+xml" title="x86sec" href="http://localhost:51372/index.xml">

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="/css/main.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body><header class="site-header">
  <div class="container">
    <a class="site-logo" href="/" data-text="[x86sec]"><span class="bracket">[</span>x86sec<span class="bracket">]</span></a>
    <nav class="site-nav">
      
      <a href="/"
         class="active">
        posts
      </a>
      
      <a href="/about/"
         class="">
        about
      </a>
      
    </nav>
  </div>
</header>
<main>
<div class="container">

  
  <div class="page-hero">
    <h1>Simple ELF Crypter</h1>
    
    <div class="hero-meta">
      <span><span class="dot">date</span> February 22, 2020</span>
      
      <span><span class="dot">read</span> 5 min</span>
      
      <span>
        
        <a href="/tags/elf" class="tag">elf</a>
        
        <a href="/tags/binary" class="tag">binary</a>
        
        <a href="/tags/binary-crypter" class="tag">binary crypter</a>
        
        <a href="/tags/malware" class="tag">malware</a>
        
        <a href="/tags/elf-crypter" class="tag">elf crypter</a>
        
      </span>
      
    </div>
    
  </div>

  
  <div class="post-content">
    <article class="prose">
      <h2 id="elf-files">ELF Files</h2>
<p>There are several techniques that can be used to obsfucate what an executable does at runtime. This post will demonstrate a minimal example of a self-modifying, ELF executable that contains an encrypted section of code that, at runtime, bruteforces its own key and decrypts itself.</p>
<h2 id="elf-sections">ELF Sections</h2>
<p>ELF executables are comprised of several &ldquo;sections&rdquo;. Code that is executed, such as <code>int main()</code>, is placed inside the <code>.text</code> section.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; readelf -S a.out 
</span></span><span style="display:flex;"><span>There are <span style="color:#ae81ff">30</span> section headers, starting at offset 0x29d8:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Section Headers:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span>Nr<span style="color:#f92672">]</span> Name              Type             Address           Offset
</span></span><span style="display:flex;"><span>       Size              EntSize          Flags  Link  Info  Align
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span> 0<span style="color:#f92672">]</span>                   NULL             <span style="color:#ae81ff">0000000000000000</span>  <span style="color:#ae81ff">00000000</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0000000000000000</span>  <span style="color:#ae81ff">0000000000000000</span>           <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span> 1<span style="color:#f92672">]</span> .interp           PROGBITS         <span style="color:#ae81ff">0000000000400238</span>  <span style="color:#ae81ff">00000238</span>
</span></span><span style="display:flex;"><span>       000000000000001c  <span style="color:#ae81ff">0000000000000000</span>   A       <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span>13<span style="color:#f92672">]</span> .text             PROGBITS         <span style="color:#ae81ff">0000000000400490</span>  <span style="color:#ae81ff">00000490</span>
</span></span><span style="display:flex;"><span>       00000000000002b2  <span style="color:#ae81ff">0000000000000000</span>  AX       <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">16</span>
</span></span></code></pre></div><p>To make things easier for our encryption tool, we will create a new section called <code>.elf</code> where we will put the functions and strings we want to protect. In GCC, thankfully this is as simple as tagging a function with the section attribute: <code>__attribute__((section(&quot;.elf&quot;)))</code>.</p>
<h2 id="code-layout">Code Layout</h2>
<p>In our program, we are going to protect the function <code>main()</code> so we will &ldquo;sandwich&rdquo; it with two functions to mark the start and end so we have pointers to the region we will be decrypting at runtime.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#define CRYPT_SECTION &#34;.elf&#34;
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Align 4k so memprotect works on page aligned data
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">section_start</span>() <span style="color:#a6e22e">__attribute__</span>((<span style="color:#a6e22e">section</span>(CRYPT_SECTION)))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">__attribute__</span>((<span style="color:#a6e22e">aligned</span>(<span style="color:#ae81ff">4096</span>)));
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Protected (encrypted) function
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() <span style="color:#a6e22e">__attribute__</span>((<span style="color:#a6e22e">section</span>(CRYPT_SECTION)));
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Mark end
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sentinal</span>() <span style="color:#a6e22e">__attribute__</span>((<span style="color:#a6e22e">section</span>(CRYPT_SECTION))); 
</span></span></code></pre></div><p>We will define the body of <code>section_start()</code> as 4 NOPs and compile with <code>-fomit-frame-pointer</code>. This will help us to bruteforce the key as the decryption routine will attempt to guess the key until the signature of <code>\x90\x90\x90\x90</code> (4 NOPs) is found, revealing the guess is correct.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">section_start</span>() {                                                     
</span></span><span style="display:flex;"><span>    __asm__ <span style="color:#66d9ef">volatile</span>(<span style="color:#e6db74">&#34;nop</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">nop</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">nop</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">nop</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Our <code>main()</code> function can contain whatever we want. It is noteworthy to point out that any constant strings placed in here will likely <strong>not</strong> be encrypted unless we use a couple tricks. This is because the compiler will take the read-only string and place it in the <code>.rodata</code> section of the ELF (not the <code>.elf</code> section we want so that it is encrypted). To circumvent this, we will hack in a string by dynamically computing it as shown below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() { <span style="color:#75715e">// Encrypted main function
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> buf[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>    buf[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;H&#39;</span>; <span style="color:#75715e">// Build string
</span></span></span><span style="display:flex;"><span>    buf[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;i&#39;</span>;
</span></span><span style="display:flex;"><span>    buf[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, buf);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">0</span>); <span style="color:#75715e">// Call exit for clean exit
</span></span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="decryption-routine">Decryption Routine</h2>
<p>When the encrypted program executes, it will need to bruteforce the decryption key so it can decrypt the protected region and jump to it. To accomplish all of this, the protected region needs to have the memory permissions of RWX so we will set it with <code>mprotect(void *addr, size_t len, int prot)</code>. With few exceptions, process memory regions are set to not allow writing and execution at the same time (W^X) for security reasons. Because of this, we have to call <code>mprotect</code>.
<br>
<br>
To calculate the starting address and length of the encrypted region we need to pass to <code>mprotect</code>, we can do some simple pointer math:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> (<span style="color:#f92672">&amp;</span>sentinal) <span style="color:#f92672">-</span> (<span style="color:#f92672">&amp;</span>section_start);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mprotect</span>(<span style="color:#f92672">&amp;</span>section_start, len, PROT_READ<span style="color:#f92672">|</span>PROT_WRITE<span style="color:#f92672">|</span>PROT_EXEC);
</span></span></code></pre></div><p>Now that the memory can be modified, let&rsquo;s iterate over it and attempt to bruteforce the key by checking if our guess decrypts the first 4 bytes of <code>section_start()</code> to be <code>\0x90\0x90\0x90\0x90</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// Pointer to start of encrypted .elf section &amp; our helper function of NOPs
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>ptr <span style="color:#f92672">=</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>section_start;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> key <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>; i<span style="color:#f92672">++</span>) { <span style="color:#75715e">// Bruteforce 32-bit key
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Check for our 4 NOP opcodes
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (((<span style="color:#f92672">*</span>(ptr) <span style="color:#f92672">^</span> i) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x90</span>) <span style="color:#f92672">&amp;&amp;</span> ((<span style="color:#f92672">*</span>(ptr <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">^</span> i) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x90</span>) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>         ((<span style="color:#f92672">*</span>(ptr <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">^</span> i) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x90</span>) <span style="color:#f92672">&amp;&amp;</span> ((<span style="color:#f92672">*</span>(ptr <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">^</span> i) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x90</span>)) {
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Found the key! %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, key);
</span></span></code></pre></div><p>Now that the decryption key is found, we just have to decrypt the region and then jump to it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> len; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> v <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(ptr <span style="color:#f92672">+</span> i);
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>(ptr <span style="color:#f92672">+</span> i) <span style="color:#f92672">=</span> v <span style="color:#f92672">^</span> key; <span style="color:#75715e">// Do decryption
</span></span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">main</span>(); <span style="color:#75715e">// Call decrypted function!
</span></span></span></code></pre></div><h2 id="encrypting-the-elf-file">Encrypting The ELF File</h2>
<p>Since the content we are encrypting is located in the <code>.elf</code> section we created above, we need a simple program to locate the section boundries of <code>.elf</code> and encrypt it.
<br>
<br>
<a href="https://docs.pwntools.com/en/stable/">Pwntools</a> is a great Python library for doing CTFs, pentesting, and shellcoding. We will use their ELF library to make things easier.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encryptSection</span>(e):
</span></span><span style="display:flex;"><span>	cryptSection <span style="color:#f92672">=</span> e<span style="color:#f92672">.</span>get_section_by_name(<span style="color:#e6db74">&#39;.elf&#39;</span>)
</span></span><span style="display:flex;"><span>	baseAddr <span style="color:#f92672">=</span> cryptSection[<span style="color:#e6db74">&#39;sh_offset&#39;</span>]
</span></span><span style="display:flex;"><span>	sz <span style="color:#f92672">=</span> cryptSection[<span style="color:#e6db74">&#39;sh_size&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;Entry point @ 0x</span><span style="color:#e6db74">{:02X}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(e<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;Crypted Section @ 0x</span><span style="color:#e6db74">{:02X}</span><span style="color:#e6db74"> - 0x</span><span style="color:#e6db74">{:02X}</span><span style="color:#e6db74"> Size: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">B&#34;</span><span style="color:#f92672">.</span>format(baseAddr, baseAddr <span style="color:#f92672">+</span> sz, sz))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	secData <span style="color:#f92672">=</span> e<span style="color:#f92672">.</span>read(e<span style="color:#f92672">.</span>address <span style="color:#f92672">+</span> baseAddr, sz)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Encrypt data with XOR cipher (Key = 0xE3)</span>
</span></span><span style="display:flex;"><span>	encryptedData <span style="color:#f92672">=</span> [chr((ord(x)<span style="color:#f92672">^</span><span style="color:#ae81ff">0xe3</span>)) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> list(secData)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	print(hexdump(secData))
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;Encrypted:&#34;</span>)
</span></span><span style="display:flex;"><span>	print(hexdump(encryptedData))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	e<span style="color:#f92672">.</span>write(e<span style="color:#f92672">.</span>address <span style="color:#f92672">+</span> baseAddr, <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(encryptedData))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./a.out&#34;</span>)
</span></span><span style="display:flex;"><span>encryptSection(e)
</span></span><span style="display:flex;"><span>e<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;encrypted.elf&#34;</span>)
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>chmod(<span style="color:#e6db74">&#34;encrypted.elf&#34;</span>, <span style="color:#ae81ff">0777</span>)
</span></span></code></pre></div><p>Inspecting the the first 5 instructions of the to-be-protected <code>main()</code> function before encrypting it gives us the following disassembly:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>0x004005c7<span style="color:#f92672">]</span>&gt; pd <span style="color:#ae81ff">5</span> @ sym.main
</span></span><span style="display:flex;"><span>           0x00401006      4883ec28       sub rsp, 0x28
</span></span><span style="display:flex;"><span>           0x0040100a      64488b042528.  mov rax, qword fs:<span style="color:#f92672">[</span>0x28<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>           0x00401013      <span style="color:#ae81ff">4889442418</span>     mov qword <span style="color:#f92672">[</span>var_10h<span style="color:#f92672">]</span>, rax
</span></span><span style="display:flex;"><span>           0x00401018      31c0           xor eax, eax
</span></span><span style="display:flex;"><span>           0x0040101a      c6042449       mov byte <span style="color:#f92672">[</span>rsp<span style="color:#f92672">]</span>, 0x49
</span></span></code></pre></div><p>Disassembling the same function in the encrypted ELF file gives us:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>0x004005c7<span style="color:#f92672">]</span>&gt; pd <span style="color:#ae81ff">5</span> @ sym.main
</span></span><span style="display:flex;"><span>           0x00401006      ab             stosd dword <span style="color:#f92672">[</span>rdi<span style="color:#f92672">]</span>, eax
</span></span><span style="display:flex;"><span>           0x00401007      <span style="color:#ae81ff">60</span>             invalid
</span></span><span style="display:flex;"><span>           0x00401008      0fcb           bswap ebx
</span></span><span style="display:flex;"><span>           0x0040100a      87ab68e7c6cb   xchg dword <span style="color:#f92672">[</span>rbx - 0x34391898<span style="color:#f92672">]</span>, ebp
</span></span><span style="display:flex;"><span>           0x00401010      e3e3           jrcxz 0x400ff5
</span></span></code></pre></div><p>As you can see, the opcodes have changed as expected. The first opcode <code>0x48</code> XORed with our key <code>0xe3</code>, gives us the result <code>0xab</code> we are seeing in the encrypted binary.
<br>
<br>
By encrypting the region, the opcodes are no longer valid and the disassembler cannot determine what this region of code does. Worse, opcodes will be generated that decode to jump instructions which will result in incorrect control-flow graphs of the code.</p>
<h2 id="testing--code">Testing &amp; Code</h2>
<h2 id="source-code">Source Code</h2>
<p>Download: <a href="/simple_elf_crypter.tar.gz">simple_elf_crypter.tar.gz</a></p>
<h2 id="demo-environment">Demo Environment</h2>
<p>I created a Docker Container where you can play around with the source and compiled code. If you want to see how the decryption works during runtime, launch the docker container and run the <code>encrypted.elf</code> in GDB.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -ti gfoudree/simple-elf-crypter:latest
</span></span></code></pre></div><p>Then run <code>make</code> inside the container to build <code>a.out</code> (the executable before being encrypted) and <code>encrypted.elf</code> (encrypted executable).</p>

    </article>

    
    
    <div class="pagination" style="margin-top:3rem;">
      <a href="http://localhost:51372/post/hypervisor-stack-guard/">← StackSupervisor - a Hypervisor-based Stack Guard</a>
      <a href="http://localhost:51372/post/anti-reverse-engineering/">Anti Reverse Engineering Tricks →</a>
    </div>
    
  </div>

</div>

  </main><footer class="site-footer">
  <div class="container">
    <div class="footer-left">
      <strong>x86sec</strong> — a cybersecurity blog<br>
      &copy; 2026 Grant Foudree
    </div>
    <div class="footer-links">
      <a href="https://github.com/gfoudree" rel="noopener">github</a>
    </div>
  </div>
</footer>
<script src="/js/main.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
